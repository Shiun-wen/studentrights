<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å­¸ç”Ÿæ¬Šåˆ©æ•‘æ¿Ÿæ¼”è®Šå² - äº’å‹•éŠæˆ²</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', 'å¾®è»Ÿé›…é»‘', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .game-board {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .timeline {
            position: relative;
            padding: 20px 0;
        }

        .timeline::before {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 4px;
            height: 100%;
            background: linear-gradient(to bottom, #ff6b6b, #4ecdc4, #45b7d1);
        }

        .timeline-item {
            position: relative;
            margin: 40px 0;
            opacity: 0.3;
            transition: all 0.3s ease;
        }

        .timeline-item.active {
            opacity: 1;
            transform: scale(1.05);
        }

        .timeline-item.completed {
            opacity: 1;
        }

        .timeline-content {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            width: 45%;
            position: relative;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .timeline-item:nth-child(odd) .timeline-content {
            margin-left: 55%;
        }

        .timeline-item:nth-child(even) .timeline-content {
            margin-right: 55%;
        }

        .timeline-marker {
            position: absolute;
            top: 20px;
            width: 20px;
            height: 20px;
            background: #ddd;
            border-radius: 50%;
            left: 50%;
            transform: translateX(-50%);
            transition: all 0.3s ease;
        }

        .timeline-item.active .timeline-marker {
            background: #ff6b6b;
            transform: translateX(-50%) scale(1.5);
        }

        .timeline-item.completed .timeline-marker {
            background: #4ecdc4;
        }

        .scenario-card {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            border-left: 5px solid #ff6b6b;
        }

        .question-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
        }

        .choices {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 20px 0;
        }

        .choice-btn {
            padding: 15px 20px;
            border: 2px solid #ddd;
            border-radius: 10px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .choice-btn:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .choice-btn.correct {
            background: #d4edda;
            border-color: #28a745;
            color: #155724;
        }

        .choice-btn.incorrect {
            background: #f8d7da;
            border-color: #dc3545;
            color: #721c24;
        }

        .feedback {
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            display: none;
        }

        .feedback.correct {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .feedback.incorrect {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }

        .next-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: none;
        }

        .next-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .score-board {
            background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%);
            color: white;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            margin: 20px 0;
        }

        .game-controls {
            text-align: center;
            margin: 20px 0;
        }

        .control-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            margin: 0 10px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .game-over {
            text-align: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 20px;
            padding: 40px;
            display: none;
        }

        .score-history {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            backdrop-filter: blur(10px);
        }

        .score-entry {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .score-entry:last-child {
            border-bottom: none;
        }

        .score-medal {
            font-size: 1.5rem;
            margin-right: 10px;
        }

        .hidden {
            display: none;
        }

        @media (max-width: 768px) {
            .choices {
                grid-template-columns: 1fr;
            }
            
            .timeline-content {
                width: 80%;
                margin-left: 20% !important;
                margin-right: 0 !important;
            }
            
            .timeline::before {
                left: 10%;
            }
            
            .timeline-marker {
                left: 10%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ›ï¸ å­¸ç”Ÿæ¬Šåˆ©æ•‘æ¿Ÿæ¼”è®Šå²</h1>
            <p>é€éäº’å‹•éŠæˆ²äº†è§£å¤§æ³•å®˜é‡‹å­—ç¬¬382ã€684ã€784è™Ÿè§£é‡‹</p>
        </div>

        <div class="score-board">
            <h3>ğŸ¯ éŠæˆ²é€²åº¦</h3>
            <p>åˆ†æ•¸: <span id="score">0</span>/100 | é—œå¡: <span id="level">1</span>/6</p>
        </div>

        <div class="game-board">
            <div class="timeline" id="timeline">
                <div class="timeline-item active" data-level="1">
                    <div class="timeline-marker"></div>
                    <div class="timeline-content">
                        <h3>ğŸ“š ç‰¹åˆ¥æ¬ŠåŠ›é—œä¿‚æ™‚ä»£</h3>
                        <p>1995å¹´ä»¥å‰ï¼Œå­¸ç”Ÿè¢«è¦–ç‚ºç‰¹åˆ¥æ¬ŠåŠ›é—œä¿‚ä¸­çš„å¼±å‹¢æ–¹</p>
                    </div>
                </div>
                
                <div class="timeline-item" data-level="2">
                    <div class="timeline-marker"></div>
                    <div class="timeline-content">
                        <h3>ğŸ”“ é‡‹å­—ç¬¬382è™Ÿ (1995)</h3>
                        <p>ç ´å†°èˆ‡ä¾·é™ï¼šé–‹å•Ÿé€€å­¸è™•åˆ†æ•‘æ¿Ÿä¹‹é–€</p>
                    </div>
                </div>
                
                <div class="timeline-item" data-level="3">
                    <div class="timeline-marker"></div>
                    <div class="timeline-content">
                        <h3>ğŸ“ é‡‹å­—ç¬¬684è™Ÿ (2011)</h3>
                        <p>éæ¸¡èˆ‡åˆ†æ­§ï¼šå¤§å­¸ç”Ÿå°ˆå±¬æ“´å¼µ</p>
                    </div>
                </div>
                
                <div class="timeline-item" data-level="4">
                    <div class="timeline-marker"></div>
                    <div class="timeline-content">
                        <h3>ğŸŒŸ é‡‹å­—ç¬¬784è™Ÿ (2019)</h3>
                        <p>å…¨é¢è§£ç¦ï¼šå„ç´šå­¸æ ¡å­¸ç”Ÿæ¬Šåˆ©å¤§è§£æ”¾</p>
                    </div>
                </div>
                
                <div class="timeline-item" data-level="5">
                    <div class="timeline-marker"></div>
                    <div class="timeline-content">
                        <h3>âš–ï¸ å¯¦å‹™æ‡‰ç”¨</h3>
                        <p>æ¡ˆä¾‹åˆ†æèˆ‡åˆ¤æ–·æ¨™æº–</p>
                    </div>
                </div>
                
                <div class="timeline-item" data-level="6">
                    <div class="timeline-marker"></div>
                    <div class="timeline-content">
                        <h3>ğŸ† ç¶œåˆæ¸¬é©—</h3>
                        <p>æ¸¬è©¦ä½ çš„å­¸ç¿’æˆæœ</p>
                    </div>
                </div>
            </div>

            <div id="game-content">
                <!-- éŠæˆ²å…§å®¹å°‡å‹•æ…‹è¼‰å…¥ -->
            </div>

            <div class="game-controls">
                <button class="control-btn" onclick="startGame()">é–‹å§‹éŠæˆ²</button>
                <button class="control-btn" onclick="resetGame()">é‡æ–°é–‹å§‹</button>
            </div>
        </div>

        <div class="game-over" id="gameOver">
            <h2>ğŸ‰ æ­å–œå®ŒæˆéŠæˆ²ï¼</h2>
            <p>ä½ å°å­¸ç”Ÿæ¬Šåˆ©æ•‘æ¿Ÿçš„æ¼”è®Šæœ‰äº†æ·±å…¥äº†è§£</p>
            <div id="finalScore"></div>
            
            <div class="score-history" id="scoreHistory">
                <h3>ğŸ“Š æ­·å²æˆç¸¾</h3>
                <div id="scoreList"></div>
                <div style="margin-top: 15px; font-size: 0.9rem; opacity: 0.8;">
                    <span id="bestScore"></span> | <span id="averageScore"></span> | ç¸½éŠæˆ²æ¬¡æ•¸: <span id="gameCount"></span>
                </div>
            </div>
            
            <button class="control-btn" onclick="resetGame()">å†ç©ä¸€æ¬¡</button>
        </div>
    </div>

    <script>
        let currentLevel = 1;
        let score = 0;
        let gameStarted = false;
        let scoreHistory = [];

        // è¼‰å…¥æ­·å²åˆ†æ•¸
        function loadScoreHistory() {
            const saved = localStorage.getItem('constitutionGameScores');
            if (saved) {
                try {
                    scoreHistory = JSON.parse(saved);
                } catch (e) {
                    scoreHistory = [];
                }
            }
        }

        // å„²å­˜åˆ†æ•¸åˆ°æ­·å²è¨˜éŒ„
        function saveScore(score) {
            const now = new Date();
            const scoreEntry = {
                score: score,
                date: now.toLocaleDateString('zh-TW'),
                time: now.toLocaleTimeString('zh-TW', { hour: '2-digit', minute: '2-digit' })
            };
            
            scoreHistory.unshift(scoreEntry); // æ–°åˆ†æ•¸åŠ åˆ°é–‹é ­
            
            // åªä¿ç•™æœ€è¿‘10æ¬¡è¨˜éŒ„
            if (scoreHistory.length > 10) {
                scoreHistory = scoreHistory.slice(0, 10);
            }
            
            localStorage.setItem('constitutionGameScores', JSON.stringify(scoreHistory));
        }

        // ç²å–åˆ†æ•¸çµ±è¨ˆ
        function getScoreStats() {
            if (scoreHistory.length === 0) {
                return { best: 0, average: 0, count: 0 };
            }
            
            const scores = scoreHistory.map(entry => entry.score);
            const best = Math.max(...scores);
            const average = Math.round(scores.reduce((a, b) => a + b, 0) / scores.length);
            
            return { best, average, count: scoreHistory.length };
        }

        // ç²å–æˆç¸¾ç­‰ç´šå’Œçç« 
        function getGradeInfo(score) {
            if (score === 100) return { grade: 'ğŸ† å®Œç¾é”äºº', medal: 'ğŸ†' };
            if (score >= 85) return { grade: 'â­ æ³•å¾‹é”äºº', medal: 'â­' };
            if (score >= 70) return { grade: 'ğŸ“š æ†²æ³•é€š', medal: 'ğŸ“š' };
            if (score >= 50) return { grade: 'ğŸ’ª åŠªåŠ›å­¸ç¿’ä¸­', medal: 'ğŸ’ª' };
            return { grade: 'ğŸŒ± ç¹¼çºŒåŠ æ²¹', medal: 'ğŸŒ±' };
        }

        const gameData = {
            1: {
                title: "ç‰¹åˆ¥æ¬ŠåŠ›é—œä¿‚æ™‚ä»£",
                scenario: "ğŸ« 1990å¹´ä»£çš„æ ¡åœ’ï¼šå°æ˜å› ç‚ºä¸Šèª²è¬›è©±è¢«è€å¸«è¨˜éï¼Œä»–æƒ³è¦ç”³è¨´é€™å€‹è™•åˆ†...",
                question: "åœ¨å‚³çµ±çš„ç‰¹åˆ¥æ¬ŠåŠ›é—œä¿‚ä¸‹ï¼Œå°æ˜å¯ä»¥æ€éº¼åšï¼Ÿ",
                choices: [
                    "å‘æ³•é™¢æèµ·è¡Œæ”¿è¨´è¨Ÿ",
                    "åªèƒ½æ¥å—è™•åˆ†ï¼Œç„¡æ³•æ•‘æ¿Ÿ",
                    "å‘æ•™è‚²éƒ¨ç”³è¨´",
                    "æ‰¾å®¶é•·å”èª¿"
                ],
                correct: 1,
                explanation: "åœ¨ç‰¹åˆ¥æ¬ŠåŠ›é—œä¿‚ç†è«–ä¸‹ï¼Œå­¸ç”Ÿå°å­¸æ ¡çš„ç®¡ç†æªæ–½åŸå‰‡ä¸Šç„¡æ³•æèµ·å¸æ³•æ•‘æ¿Ÿï¼Œåªèƒ½é€éæ ¡å…§é€”å¾‘æˆ–æ¥å—è™•åˆ†ã€‚"
            },
            2: {
                title: "é‡‹å­—ç¬¬382è™Ÿè§£é‡‹ (1995)",
                scenario: "ğŸ“œ å¤§æ³•å®˜é¦–æ¬¡é¬†å‹•ç‰¹åˆ¥æ¬ŠåŠ›é—œä¿‚ï¼å­¸ç”Ÿé˜¿è¯å› ç‚ºæ‰“æ¶è¢«å­¸æ ¡å‹’ä»¤é€€å­¸ï¼Œä»–ä¸æœé€™å€‹æ±ºå®š...",
                question: "æ ¹æ“šé‡‹å­—ç¬¬382è™Ÿè§£é‡‹ï¼Œé˜¿è¯æ˜¯å¦å¯ä»¥æèµ·è¡Œæ”¿è¨´è¨Ÿï¼Ÿ",
                choices: [
                    "å¯ä»¥ï¼Œå› ç‚ºé€€å­¸å½±éŸ¿å—æ•™è‚²æ¬Š",
                    "ä¸å¯ä»¥ï¼Œä»å±¬æ ¡å…§äº‹å‹™",
                    "åªæœ‰å¤§å­¸ç”Ÿæ‰å¯ä»¥",
                    "è¦çœ‹å­¸æ ¡åŒä¸åŒæ„"
                ],
                correct: 0,
                explanation: "é‡‹å­—ç¬¬382è™Ÿé¦–æ¬¡ç¢ºç«‹ï¼šå°æ–¼é€€å­¸æˆ–é¡æ­¤è™•åˆ†ï¼Œå› å…¶å°å—æ•™è‚²æ¬Šæœ‰é‡å¤§å½±éŸ¿ï¼Œå­¸ç”Ÿå¯ä»¥æèµ·è¡Œæ”¿è¨´è¨Ÿã€‚"
            },
            3: {
                title: "é‡‹å­—ç¬¬684è™Ÿè§£é‡‹ (2011)",
                scenario: "ğŸ“ å¤§å­¸ç”Ÿå°ç¾å› ç‚ºé¸èª²è¢«æ‹’çµ•ï¼Œå¥¹èªç‚ºé€™ä¾µå®³äº†å¥¹çš„å­¸ç¿’æ¬Šï¼Œä½†é€™ä¸æ˜¯é€€å­¸è™•åˆ†...",
                question: "æ ¹æ“šé‡‹å­—ç¬¬684è™Ÿè§£é‡‹ï¼Œå°ç¾æ˜¯å¦å¯ä»¥æèµ·è¨´è¨Ÿï¼Ÿ",
                choices: [
                    "ä¸å¯ä»¥ï¼Œå› ç‚ºä¸æ˜¯é€€å­¸è™•åˆ†",
                    "å¯ä»¥ï¼Œä½†åƒ…é™å¤§å­¸ç”Ÿ",
                    "æ‰€æœ‰å­¸ç”Ÿéƒ½å¯ä»¥",
                    "è¦å…ˆç¶“éæ ¡å…§ç”³è¨´"
                ],
                correct: 1,
                explanation: "é‡‹å­—ç¬¬684è™Ÿæ“´å¤§å¤§å­¸ç”Ÿçš„æ•‘æ¿Ÿç¯„åœï¼Œä¸å†é™æ–¼é€€å­¸è™•åˆ†ï¼Œä½†ä¿éšœåƒ…é™æ–¼å¤§å­¸ç”Ÿã€‚"
            },
            4: {
                title: "é‡‹å­—ç¬¬784è™Ÿè§£é‡‹ (2019)",
                scenario: "ğŸŒˆ æ­·å²æ€§çªç ´ï¼åœ‹ä¸­ç”Ÿå°å‚‘å› ç‚ºç—…å‡è£œè€ƒæˆç¸¾è¢«æ‰“æŠ˜ï¼Œé«˜ä¸­ç”Ÿå°ç¾å› ç‚ºå¼å«é¦™è¸è¢«è¨˜é...",
                question: "æ ¹æ“šé‡‹å­—ç¬¬784è™Ÿè§£é‡‹ï¼Œä»–å€‘çš„æƒ…æ³å¦‚ä½•ï¼Ÿ",
                choices: [
                    "éƒ½ä¸èƒ½æèµ·è¨´è¨Ÿ",
                    "åªæœ‰é«˜ä¸­ç”Ÿå¯ä»¥",
                    "éƒ½å¯èƒ½å¯ä»¥æèµ·è¨´è¨Ÿ",
                    "è¦çœ‹è™•åˆ†è¼•é‡"
                ],
                correct: 2,
                explanation: "é‡‹å­—ç¬¬784è™Ÿå…¨é¢é–‹æ”¾å„ç´šå­¸æ ¡å­¸ç”Ÿçš„è¨´è¨Ÿæ¬Šï¼Œåªè¦æ¬Šåˆ©å—ä¾µå®³ä¸”éé¡¯ç„¶è¼•å¾®ä¹‹å¹²é ï¼Œå³å¯æ•‘æ¿Ÿã€‚"
            },
            5: {
                title: "å¯¦å‹™æ‡‰ç”¨ï¼šé¡¯ç„¶è¼•å¾®ä¹‹å¹²é ",
                scenario: "âš–ï¸ å°å¼·ä¸‰æ¬¡æœªåƒåŠ å‡æ——è¢«è¨˜ä¸‰æ¬¡è­¦å‘Šï¼Œä»–æèµ·è¨´è¨Ÿã€‚æ³•é™¢å¿…é ˆåˆ¤æ–·é€™æ˜¯å¦æ§‹æˆæ¬Šåˆ©ä¾µå®³...",
                question: "æ³•é™¢å¯èƒ½å¦‚ä½•èªå®šï¼Ÿ",
                choices: [
                    "ä¸€å®šå‹è¨´ï¼Œå› ç‚ºä¾µå®³è‡ªç”±",
                    "å¯èƒ½æ•—è¨´ï¼Œå±¬é¡¯ç„¶è¼•å¾®å¹²é ",
                    "è‡ªå‹•å‹è¨´ï¼Œä¸ç”¨å¯©ç†",
                    "è½‰å›æ ¡å…§ç”³è¨´"
                ],
                correct: 1,
                explanation: "æ³•é™¢éœ€ç¶œåˆè€ƒé‡æªæ–½çš„ç›®çš„ã€æ€§è³ªåŠå¹²é ç¨‹åº¦ã€‚è¨˜è­¦å‘Šä¸”å¯éŠ·éï¼Œå¯èƒ½è¢«èªå®šç‚ºé¡¯ç„¶è¼•å¾®ä¹‹å¹²é ã€‚"
            },
            6: {
                title: "ç¶œåˆæ¸¬é©—",
                scenario: "ğŸ† æœ€çµ‚æŒ‘æˆ°ï¼šé‡‹å­—ç¬¬784è™Ÿè§£é‡‹çš„æ ¸å¿ƒç²¾ç¥æ˜¯ä»€éº¼ï¼Ÿ",
                question: "é€™ä¸‰è™Ÿè§£é‡‹çš„æ¼”è®Šé«”ç¾äº†ä»€éº¼æ†²æ³•åŸå‰‡ï¼Ÿ",
                choices: [
                    "æ•™è‚²å°ˆæ¥­åŸå‰‡",
                    "æœ‰æ¬Šåˆ©å³æœ‰æ•‘æ¿ŸåŸå‰‡",
                    "ç‰¹åˆ¥æ¬ŠåŠ›é—œä¿‚åŸå‰‡",
                    "å­¸æ ¡è‡ªæ²»åŸå‰‡"
                ],
                correct: 1,
                explanation: "é€™ä¸‰è™Ÿè§£é‡‹çš„æ¼”è®Šå®Œç¾é«”ç¾äº†æ†²æ³•ç¬¬16æ¢ã€æœ‰æ¬Šåˆ©å³æœ‰æ•‘æ¿Ÿã€çš„æ ¸å¿ƒåŸå‰‡ï¼Œå¾é™åˆ¶åˆ°å…¨é¢ä¿éšœå­¸ç”Ÿè¨´è¨Ÿæ¬Šã€‚"
            }
        };

        function startGame() {
            gameStarted = true;
            currentLevel = 1;
            score = 0;
            updateDisplay();
            loadLevel(currentLevel);
        }

        function loadLevel(level) {
            const data = gameData[level];
            const content = document.getElementById('game-content');
            
            content.innerHTML = `
                <div class="scenario-card">
                    <h3>${data.title}</h3>
                    <p>${data.scenario}</p>
                </div>
                
                <div class="question-section">
                    <h4>â“ ${data.question}</h4>
                    <div class="choices" id="choices">
                        ${data.choices.map((choice, index) => 
                            `<button class="choice-btn" onclick="selectChoice(${index})">${choice}</button>`
                        ).join('')}
                    </div>
                    <div class="feedback" id="feedback"></div>
                    <button class="next-btn" id="nextBtn" onclick="nextLevel()">ä¸‹ä¸€é—œ â†’</button>
                </div>
            `;
            
            updateTimeline();
        }

        function selectChoice(selectedIndex) {
            const data = gameData[currentLevel];
            const choices = document.querySelectorAll('.choice-btn');
            const feedback = document.getElementById('feedback');
            const nextBtn = document.getElementById('nextBtn');
            
            // ç¦ç”¨æ‰€æœ‰é¸é …
            choices.forEach(btn => btn.style.pointerEvents = 'none');
            
            // æ¨™è¨˜æ­£ç¢ºå’ŒéŒ¯èª¤ç­”æ¡ˆ
            choices[data.correct].classList.add('correct');
            if (selectedIndex !== data.correct) {
                choices[selectedIndex].classList.add('incorrect');
            }
            
            // é¡¯ç¤ºåé¥‹
            feedback.style.display = 'block';
            if (selectedIndex === data.correct) {
                feedback.className = 'feedback correct';
                feedback.innerHTML = `<strong>âœ… æ­£ç¢ºï¼</strong><br>${data.explanation}`;
                
                // ä¿®æ­£è¨ˆåˆ†é‚è¼¯ï¼šç¢ºä¿å…¨å°å¯å¾—100åˆ†
                const totalLevels = Object.keys(gameData).length;
                const baseScore = Math.floor(100 / totalLevels);
                const remainder = 100 - (baseScore * totalLevels);
                
                // å‰å¹¾é—œå¾—åŸºæœ¬åˆ†ï¼Œæœ€å¾Œå¹¾é—œå¾—åŸºæœ¬åˆ†+é¤˜æ•¸
                if (currentLevel <= totalLevels - remainder) {
                    score += baseScore;
                } else {
                    score += baseScore + 1;
                }
            } else {
                feedback.className = 'feedback incorrect';
                feedback.innerHTML = `<strong>âŒ éŒ¯èª¤ï¼</strong><br>æ­£ç¢ºç­”æ¡ˆæ˜¯ï¼š${data.choices[data.correct]}<br>${data.explanation}`;
            }
            
            updateDisplay();
            nextBtn.style.display = 'block';
        }

        function nextLevel() {
            if (currentLevel < Object.keys(gameData).length) {
                currentLevel++;
                loadLevel(currentLevel);
            } else {
                endGame();
            }
        }

        function updateDisplay() {
            document.getElementById('score').textContent = score;
            document.getElementById('level').textContent = currentLevel;
        }

        function updateTimeline() {
            const items = document.querySelectorAll('.timeline-item');
            items.forEach((item, index) => {
                const level = index + 1;
                item.classList.remove('active', 'completed');
                
                if (level < currentLevel) {
                    item.classList.add('completed');
                } else if (level === currentLevel) {
                    item.classList.add('active');
                }
            });
        }

        function endGame() {
            // å„²å­˜æœ¬æ¬¡åˆ†æ•¸
            saveScore(score);
            
            document.querySelector('.game-board').style.display = 'none';
            const gameOver = document.getElementById('gameOver');
            gameOver.style.display = 'block';
            
            const gradeInfo = getGradeInfo(score);
            
            document.getElementById('finalScore').innerHTML = `
                <h3>æœ¬æ¬¡åˆ†æ•¸ï¼š${score}åˆ†</h3>
                <p>è©•ç´šï¼š${gradeInfo.grade}</p>
            `;
            
            // é¡¯ç¤ºæ­·å²æˆç¸¾
            displayScoreHistory();
        }

        function displayScoreHistory() {
            const stats = getScoreStats();
            const scoreList = document.getElementById('scoreList');
            
            // æ›´æ–°çµ±è¨ˆè³‡è¨Š
            document.getElementById('bestScore').textContent = `æœ€é«˜åˆ†: ${stats.best}åˆ†`;
            document.getElementById('averageScore').textContent = `å¹³å‡åˆ†: ${stats.average}åˆ†`;
            document.getElementById('gameCount').textContent = stats.count;
            
            // é¡¯ç¤ºæ­·å²åˆ†æ•¸åˆ—è¡¨
            if (scoreHistory.length === 0) {
                scoreList.innerHTML = '<p style="opacity: 0.7;">é‚„æ²’æœ‰æ­·å²è¨˜éŒ„</p>';
                return;
            }
            
            scoreList.innerHTML = scoreHistory.map((entry, index) => {
                const gradeInfo = getGradeInfo(entry.score);
                const isLatest = index === 0;
                
                return `
                    <div class="score-entry" style="${isLatest ? 'background: rgba(255,255,255,0.1); border-radius: 8px; padding: 12px;' : ''}">
                        <div>
                            <span class="score-medal">${gradeInfo.medal}</span>
                            <span>${entry.date} ${entry.time}</span>
                            ${isLatest ? '<span style="margin-left: 8px; font-size: 0.8rem; background: #ff6b6b; padding: 2px 6px; border-radius: 10px;">æœ€æ–°</span>' : ''}
                        </div>
                        <div style="font-weight: bold; font-size: 1.1rem;">
                            ${entry.score}åˆ†
                        </div>
                    </div>
                `;
            }).join('');
        }

        function resetGame() {
            currentLevel = 1;
            score = 0;
            gameStarted = false;
            document.querySelector('.game-board').style.display = 'block';
            document.getElementById('gameOver').style.display = 'none';
            document.getElementById('game-content').innerHTML = '';
            updateDisplay();
            updateTimeline();
        }

        // åˆå§‹åŒ–
        loadScoreHistory();
        updateDisplay();
        updateTimeline();
    </script>
</body>
</html>
